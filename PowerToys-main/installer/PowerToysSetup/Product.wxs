<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension" >

    <!-- Names of folders and projects -->
    <?define FancyZonesProjectName="FancyZones"?>
    <?define ImageResizerProjectName="ImageResizer"?>
    <?define KeyboardManagerProjectName="KeyboardManager"?>
    <?define PowerRenameProjectName="PowerRename"?>
    <?define ColorPickerProjectName="ColorPicker"?>
    <?define VideoConferenceProjectName="VideoConference"?>
    <?define AwakeProjectName="Awake"?>
    <?define MouseUtilsProjectName="MouseUtils"?>
    <?define AlwaysOnTopProjectName="AlwaysOnTop"?>

    <?define RepoDir="$(var.ProjectDir)..\..\" ?>
    <?define BinX32Dir="$(var.RepoDir)x86\$(var.Configuration)\" ?>
    <?define BinX64Dir="$(var.RepoDir)x64\$(var.Configuration)\" ?>
    <?define ShortcutGuideExecutable=$(var.BinX64Dir)\modules\ShortcutGuide\ShortcutGuide?>
    <?define ShortcutGuideModuleInterface=$(var.BinX64Dir)\modules\ShortcutGuide\ShortcutGuideModuleInterface?>

    <!-- WiX Components with multiple files cause issues due to the way Windows installs them. 
         Windows decides whether to install a component by checking the existence of KeyPath file and its version.
         Thus, if some files were updated but KeyPath file was not, the component wouldn't be updated.
         Some resource files, e.g. images, do not have version, so even if Component has only a single image and a static GUID, it won't be updated.
         
         Considering all of the above, it's much simpler to just have one file per Component with an implicit Guid.

         More info:
         - https://stackoverflow.com/a/1604348/657390
         - https://stackoverflow.com/a/1422121/657390
         - https://robmensching.com/blog/posts/2003/10/18/component-rules-101/
         - https://robmensching.com/blog/posts/2003/10/4/windows-installer-components-introduction/
           -->
    <?define ShortcutGuideSvgsFiles=0.svg;1.svg;2.svg;3.svg;4.svg;5.svg;6.svg;7.svg;8.svg;9.svg;no_active_window.svg;overlay.svg;overlay_portrait.svg?>

    <?define FancyZonesFiles=PowerToys.FancyZonesModuleInterface.dll;PowerToys.FancyZonesEditor.dll;PowerToys.FancyZonesEditor.runtimeconfig.json;PowerToys.FancyZonesEditor.deps.json;PowerToys.FancyZonesEditor.exe;PowerToys.FancyZones.exe;ControlzEx.dll;Microsoft.Xaml.Behaviors.dll;ModernWpf.dll;ModernWpf.Controls.dll;System.Text.Json.dll;PowerToys.Interop.dll;PowerToys.ManagedCommon.dll;PowerToys.Common.UI.dll;PowerToys.ManagedTelemetry.dll;System.IO.Abstractions.dll;Microsoft.Windows.SDK.NET.dll;WinRT.Runtime.dll?>
    
    <?define ImageResizerFiles=PowerToys.ImageResizer.exe;PowerToys.ImageResizerExt.dll;PowerToys.ImageResizer.dll;PowerToys.ImageResizer.deps.json;PowerToys.ImageResizer.runtimeconfig.json;PowerToys.ManagedCommon.dll;PowerToys.ManagedTelemetry.dll;PowerToys.Common.UI.dll;ControlzEx.dll;ModernWpf.Controls.dll;ModernWpf.dll;System.Text.Json.dll;Microsoft.Xaml.Behaviors.dll;PowerToys.Interop.dll;System.IO.Abstractions.dll;WinRT.Runtime.dll;Microsoft.Windows.SDK.NET.dll ?>

    <?define PowerPreviewFiles=PowerToys.powerpreview.dll;PowerToys.PreviewHandlerCommon.dll;PowerToys.PreviewHandlerCommon.deps.json;PowerToys.ManagedCommon.dll;PowerToys.ManagedTelemetry.dll;PowerToys.SvgPreviewHandler.dll;PowerToys.SvgPreviewHandler.comhost.dll;PowerToys.SvgPreviewHandler.runtimeconfig.json;PowerToys.SvgPreviewHandler.deps.json;PowerToys.SvgThumbnailProvider.dll;PowerToys.SvgThumbnailProvider.comhost.dll;PowerToys.SvgThumbnailProvider.runtimeconfig.json;PowerToys.SvgThumbnailProvider.deps.json;PowerToys.MarkdownPreviewHandler.dll;PowerToys.MarkdownPreviewHandler.comhost.dll;PowerToys.MarkdownPreviewHandler.runtimeconfig.json;PowerToys.MarkdownPreviewHandler.deps.json;Markdig.Signed.dll;HtmlAgilityPack.dll;System.IO.Abstractions.dll;monaco_languages.json;PowerToys.Common.UI.dll;PowerToys.MonacoPreviewHandler.dll;PowerToys.MonacoPreviewHandler.comhost.dll;PowerToys.MonacoPreviewHandler.runtimeconfig.json;PowerToys.MonacoPreviewHandler.deps.json;ControlzEx.dll;Microsoft.Web.WebView2.Core.dll;Microsoft.Web.WebView2.WinForms.dll;Microsoft.Web.WebView2.Wpf.dll;System.Runtime.WindowsRuntime.dll;index.html;PowerToys.PdfPreviewHandler.dll;PowerToys.PdfPreviewHandler.comhost.dll;PowerToys.PdfPreviewHandler.runtimeconfig.json;PowerToys.PdfPreviewHandler.deps.json;Microsoft.Windows.SDK.NET.dll;WinRT.Runtime.dll;PowerToys.PdfThumbnailProvider.dll;PowerToys.PdfThumbnailProvider.comhost.dll;PowerToys.PdfThumbnailProvider.runtimeconfig.json;PowerToys.PdfThumbnailProvider.deps.json;PowerToys.GcodePreviewHandler.dll;PowerToys.GcodePreviewHandler.comhost.dll;PowerToys.GcodePreviewHandler.runtimeconfig.json;PowerToys.GcodePreviewHandler.deps.json;PowerToys.GcodeThumbnailProvider.dll;PowerToys.GcodeThumbnailProvider.comhost.dll;PowerToys.GcodeThumbnailProvider.runtimeconfig.json;PowerToys.GcodeThumbnailProvider.deps.json;PowerToys.StlThumbnailProvider.dll;PowerToys.StlThumbnailProvider.comhost.dll;PowerToys.StlThumbnailProvider.runtimeconfig.json;PowerToys.StlThumbnailProvider.deps.json;HelixToolkit.dll;HelixToolkit.Core.Wpf.dll?>
    
    <?define SettingsV2Files=concrt140_app.dll;Microsoft.Bcl.AsyncInterfaces.dll;System.IO.Abstractions.dll;PowerToys.Settings.UI.Lib.dll;PowerToys.Settings.dll;Microsoft.Toolkit.dll;Microsoft.Toolkit.Uwp.dll;Microsoft.Toolkit.Uwp.UI.dll;Microsoft.Toolkit.Win32.UI.XamlHost.dll;Microsoft.Toolkit.Win32.UI.XamlHost.Managed.dll;Microsoft.Toolkit.Wpf.UI.Controls.dll;Microsoft.Toolkit.Wpf.UI.XamlHost.dll;Microsoft.UI.Xaml.dll;Microsoft.Xaml.Interactions.dll;Microsoft.Xaml.Interactivity.dll;msvcp140_1_app.dll;msvcp140_2_app.dll;msvcp140_app.dll;PowerToys.Interop.dll;System.Runtime.CompilerServices.Unsafe.dll;System.Text.Encodings.Web.dll;System.Text.Json.dll;vcamp140_app.dll;vccorlib140_app.dll;vcomp140_app.dll;vcruntime140_1_app.dll;vcruntime140_app.dll;PowerToys.ManagedTelemetry.dll;PowerToys.ManagedCommon.dll;ColorCode.Core.dll;ColorCode.UWP.dll;Microsoft.Graphics.Canvas.winmd;Microsoft.Toolkit.Uwp.UI.Controls.Core.dll;Microsoft.Toolkit.Uwp.UI.Controls.DataGrid.dll;Microsoft.Toolkit.Uwp.UI.Controls.Input.dll;Microsoft.Toolkit.Uwp.UI.Controls.Layout.dll;Microsoft.Toolkit.Uwp.UI.Controls.Markdown.dll;Microsoft.Toolkit.Uwp.UI.Controls.Media.dll;Microsoft.Toolkit.Uwp.UI.Controls.Primitives.dll;Microsoft.Toolkit.Uwp.pri;Microsoft.Toolkit.Uwp.UI.pri;Microsoft.Toolkit.Win32.UI.XamlHost.pri;Microsoft.UI.Xaml.pri;Microsoft.Xaml.Interactions.pri;Microsoft.Xaml.Interactivity.pri;resources.pri;PowerToys.Settings.exe;PowerToys.Settings.UI.exe;PowerToys.Settings.deps.json;PowerToys.Settings.runtimeconfig.json;NoiseAsset_256x256_PNG.png;Microsoft.Toolkit.Win32.UI.XamlHost.winmd;Microsoft.UI.Xaml.winmd;App.xbf;PowerToys.Settings.UI.xr.xml;Microsoft.Toolkit.Win32.UI.XamlHost.xml?>

    <?define SettingsV2AssetsModulesFiles=ColorPicker.png;FancyZones.png;AlwaysOnTop.png;Awake.png;ImageResizer.png;KBM.png;MouseUtils.png;PowerLauncher.png;PowerPreview.png;PowerRename.png;PT.png;ShortcutGuide.png;VideoConference.png?>

	<?define SettingsV2OOBEAssetsModulesFiles=ColorPicker.gif;AlwaysOnTop.png;Awake.png;FancyZones.gif;FileExplorer.png;ImageResizer.gif;KBM.gif;MouseUtils.gif;PowerRename.gif;Run.gif;OOBEShortcutGuide.png;VideoConferenceMute.png;OOBEPTHero.png?>

	<?define SettingsV2OOBEAssetsFluentIconsFiles=ColorPicker.png;FancyZones.png;AlwaysOnTop.png;Awake.png;FileExplorerPreview.png;FindMyMouse.png;ImageResizer.png;KeyboardManager.png;MouseHighlighter.png;MouseCrosshairs.png;MouseUtils.png;PowerRename.png;PowerToys.png;PowerToysRun.png;Settings.png;ShortcutGuide.png;VideoConferenceMute.png?>

	<?define SettingsV2StylesFiles=TextBlock.xbf;Button.xbf?>

	<?define launcherImagesComponentFiles=app.dark.png;app.light.png;app_error.dark.png;app_error.light.png;RunAsset.ico?>

	<?define calcComponentFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.Calculator.deps.json;Microsoft.PowerToys.Run.Plugin.Calculator.dll;PowerToys.ManagedTelemetry.dll?>

	<?define FolderComponentFiles=plugin.json;Microsoft.Plugin.Folder.deps.json;Microsoft.Plugin.Folder.dll;PowerToys.ManagedTelemetry.dll?>

	<?define FolderImagesComponentFiles=copy.dark.png;copy.light.png;delete.dark.png;delete.light.png;file.dark.png;file.light.png;folder.dark.png;folder.light.png;user.dark.png;user.light.png;Warning.dark.png;Warning.light.png?>

	<?define ProgramComponentFiles=plugin.json;Microsoft.Plugin.Program.deps.json;Microsoft.Plugin.Program.dll;PowerToys.ManagedTelemetry.dll?>

	<?define ProgramImagesComponentFiles=app.dark.png;app.light.png;disable.light.png;disable.dark.png;folder.light.png;folder.dark.png;shell.light.png;shell.dark.png;user.light.png;user.dark.png?>

	<?define ShellComponentFiles=plugin.json;Microsoft.Plugin.Shell.deps.json;Microsoft.Plugin.Shell.dll;PowerToys.ManagedTelemetry.dll?>

	<?define ShellImagesComponentFiles=shell.light.png;shell.dark.png;user.light.png;user.dark.png?>

	<?define IndexerComponentFiles=Microsoft.Plugin.Indexer.deps.json;Microsoft.Plugin.Indexer.dll;plugin.json;PowerToys.ManagedTelemetry.dll?>

	<?define IndexerImagesComponentFiles=indexer.dark.png;indexer.light.png;Warning.light.png;Warning.dark.png?>

	<?define UnitConvCompFiles=plugin.json;Community.PowerToys.Run.Plugin.UnitConverter.deps.json;Community.PowerToys.Run.Plugin.UnitConverter.dll?>

	<?define WebSrchCompFiles=plugin.json;Community.PowerToys.Run.Plugin.WebSearch.deps.json;Community.PowerToys.Run.Plugin.WebSearch.dll?>

	<?define UriComponentFiles=plugin.json;Microsoft.Plugin.Uri.deps.json;Microsoft.Plugin.Uri.dll;PowerToys.ManagedTelemetry.dll?>

	<?define VSCWrkCompFiles=plugin.json;Community.PowerToys.Run.Plugin.VSCodeWorkspaces.dll?>

	<?define WindowWlkrCompFiles=plugin.json;Microsoft.Plugin.WindowWalker.deps.json;Microsoft.Plugin.WindowWalker.dll;PowerToys.ManagedTelemetry.dll?>
	
	<?define WindowWlkrImagesCompFiles=windowwalker.dark.png;windowwalker.light.png;info.dark.png;info.light.png?>

	<?define RegistryComponentFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.Registry.deps.json;Microsoft.PowerToys.Run.Plugin.Registry.dll;PowerToys.ManagedTelemetry.dll?>

	<?define ServiceComponentFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.Service.deps.json;Microsoft.PowerToys.Run.Plugin.Service.dll?>

	<?define SystemComponentFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.System.deps.json;Microsoft.PowerToys.Run.Plugin.System.dll?>

	<?define SystemImagesComponentFiles=lock.dark.png;lock.light.png;logoff.dark.png;logoff.light.png;recyclebin.dark.png;recyclebin.light.png;restart.dark.png;restart.light.png;shutdown.dark.png;shutdown.light.png;sleep.dark.png;sleep.light.png;firmwareSettings.dark.png;firmwareSettings.light.png?>

    <?define TimeDateComponentFiles=Microsoft.PowerToys.Run.Plugin.TimeDate.deps.json;Microsoft.PowerToys.Run.Plugin.TimeDate.dll;plugin.json;PowerToys.ManagedTelemetry.dll?>

	<?define TimeDateImagesComponentFiles=calendar.dark.png;calendar.light.png;time.dark.png;time.light.png;timeDate.dark.png;timeDate.light.png;Warning.dark.png;Warning.light.png?>

	<?define TimeZoneComponentFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.TimeZone.deps.json;Microsoft.PowerToys.Run.Plugin.TimeZone.dll;PowerToys.ManagedTelemetry.dll?>
	
	<?define WinSetCmpFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.WindowsSettings.deps.json;Microsoft.PowerToys.Run.Plugin.WindowsSettings.dll;PowerToys.ManagedTelemetry.dll?>

	<?define WinTermCmpFiles=plugin.json;Microsoft.PowerToys.Run.Plugin.WindowsTerminal.deps.json;Microsoft.PowerToys.Run.Plugin.WindowsTerminal.dll;PowerToys.ManagedTelemetry.dll?>

	<?define PowerRenameFiles=Microsoft.Toolkit.Win32.UI.XamlHost.dll;Microsoft.UI.Xaml.dll;msvcp140_app.dll;PowerToys.PowerRenameUILib.dll;PowerToys.PowerRename.exe;resources.pri;vcruntime140_1_app.dll;vcruntime140_app.dll;PowerToys.PowerRenameExt.dll?>

	
	<Product Id="*"
       Name="PowerToys (Preview)"
       Language="1033"
       Version="$(var.Version)"
       Manufacturer="Microsoft Corporation"
       UpgradeCode="42B84BF7-5FBF-473B-9C8B-049DC16F7708">

        <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" InstallPrivileges="elevated" Platform="x64" />

        <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed." />

        <Upgrade Id="42B84BF7-5FBF-473B-9C8B-049DC16F7708">
            <UpgradeVersion
               Minimum="0.0.0" Maximum="$(var.Version)"
               Property="PREVIOUSVERSIONSINSTALLED"
               IncludeMinimum="yes" IncludeMaximum="no" />
        </Upgrade>

        <MediaTemplate EmbedCab="yes" />

        <Property Id="WINDOWSBUILDNUMBER" Secure="yes">
            <RegistrySearch Id="BuildNumberSearch" Root="HKLM" Key="SOFTWARE\Microsoft\Windows NT\CurrentVersion" Name="CurrentBuildNumber" Type="raw" />
        </Property>
        <Condition Message="This application is only supported on Windows 10 version 1903 (build 18362) or higher.">
            <![CDATA[(WINDOWSBUILDNUMBER >= 18362)]]>
        </Condition>

        <Icon Id="powertoys.exe" SourceFile="$(var.BinX64Dir)svgs\icon.ico"/>
        <Property Id="ARPPRODUCTICON" Value="powertoys.exe" />
        <Feature Id="CoreFeature" Title="PowerToys" AllowAdvertise="no" Absent="disallow" TypicalDefault="install"
                 Description="Contains the Shortcut Guide and Fancy Zones features.">
            <ComponentGroupRef Id="CoreComponents" />
            <ComponentGroupRef Id="ResourcesComponents" />
            <ComponentGroupRef Id="LauncherComponents" />
            <ComponentGroupRef Id="ToolComponents" />
            <ComponentGroupRef Id="MonacoSRCHeatGenerated" />
        </Feature>
        <SetProperty Id="ARPINSTALLLOCATION" Value="[INSTALLFOLDER]" After="CostFinalize" />

        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
        <UI>
            <UIRef Id="WixUI_InstallDir"/>
            <Publish Dialog="WelcomeDlg"
                      Control="Next"
                      Event="NewDialog"
                      Value="InstallDirDlg"
                      Order="99">1</Publish>
            <Publish Dialog="InstallDirDlg"
                      Control="Back"
                      Event="NewDialog"
                      Value="WelcomeDlg"
                      Order="99">1</Publish>

            <Publish Dialog="ExitDialog"
                  Control="Finish"
                  Event="EndDialog"
                  Value="Return">NOT Installed</Publish>
            <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Property="_REMOVE_ALL" Value="Yes">1</Publish>
            <Publish Dialog="UserExit" Control="Finish" Event="DoAction" Value="TelemetryLogInstallCancel">NOT Installed</Publish>
            <Publish Dialog="FatalError" Control="Finish" Event="DoAction" Value="TelemetryLogInstallFail">NOT Installed</Publish>
            <Publish Dialog="UserExit" Control="Finish" Event="DoAction" Value="TelemetryLogUninstallCancel">Installed AND _REMOVE_ALL="Yes"</Publish>
            <Publish Dialog="FatalError" Control="Finish" Event="DoAction" Value="TelemetryLogUninstallFail">Installed AND _REMOVE_ALL="Yes"</Publish>
            <Publish Dialog="UserExit" Control="Finish" Event="DoAction" Value="TelemetryLogRepairCancel">Installed AND NOT (_REMOVE_ALL="Yes")</Publish>
            <Publish Dialog="FatalError" Control="Finish" Event="DoAction" Value="TelemetryLogRepairFail">Installed AND NOT (_REMOVE_ALL="Yes")</Publish>
        </UI>
        <WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)\Images\banner.png" />
        <WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)\Images\dialog.png" />
        <WixVariable Id="WixUILicenseRtf" Value="$(var.RepoDir)\installer\License.rtf" />
        <Property Id="INSTALLSTARTMENUSHORTCUT" Value="1"/>
        <Property Id="CREATESCHEDULEDTASK" Value="1"/>
        <Property Id="WixShellExecTarget" Value="[#PowerToys_ActionRunner.exe]" />

        <SetProperty Action="SetDEFAULTBOOTSTRAPPERINSTALLFOLDER" Id="DEFAULTBOOTSTRAPPERINSTALLFOLDER" Value="[ProgramFiles64Folder]PowerToys" Before="SetBOOTSTRAPPERINSTALLFOLDER" Sequence="execute">
        </SetProperty>
        <!-- In case we didn't receive a value from the bootstrapper. -->
        <SetProperty Action="SetBOOTSTRAPPERINSTALLFOLDER" Id="BOOTSTRAPPERINSTALLFOLDER" Value="[DEFAULTBOOTSTRAPPERINSTALLFOLDER]" Before="DetectPrevInstallPath" Sequence="execute">
          <![CDATA[BOOTSTRAPPERINSTALLFOLDER = ""]]>
        </SetProperty>
        <!-- Have to compare value sent by bootstrapper to default to avoid using it, as a check to verify it's not default. This hack can be removed if it's possible to set the bootstrapper option to the previous install folder -->
        <SetProperty Action="SetINSTALLFOLDERTOPREVIOUSINSTALLFOLDER" Id="INSTALLFOLDER" Value="[PREVIOUSINSTALLFOLDER]" After="DetectPrevInstallPath" Sequence="execute">
          <![CDATA[BOOTSTRAPPERINSTALLFOLDER = DEFAULTBOOTSTRAPPERINSTALLFOLDER AND PREVIOUSINSTALLFOLDER <> ""]]>
        </SetProperty>
        <SetProperty Action="SetINSTALLFOLDERTOBOOTSTRAPPERINSTALLFOLDER" Id="INSTALLFOLDER" Value="[BOOTSTRAPPERINSTALLFOLDER]" After="DetectPrevInstallPath" Sequence="execute">
          <![CDATA[BOOTSTRAPPERINSTALLFOLDER <> DEFAULTBOOTSTRAPPERINSTALLFOLDER OR PREVIOUSINSTALLFOLDER = ""]]>
        </SetProperty>

        <InstallExecuteSequence>
            <Custom Action="DetectPrevInstallPath" After="AppSearch" />
            <Custom Action="SetRegisterPowerToysSchTaskParam" Before="RegisterPowerToysSchTask" />
            <Custom Action="SetApplyModulesRegistryChangeSetsParam" Before="ApplyModulesRegistryChangeSets" />
            <Custom Action="SetUnApplyModulesRegistryChangeSetsParam" Before="UnApplyModulesRegistryChangeSets" />
            <Custom Action="RegisterPowerToysSchTask" After="InstallFiles">
                NOT Installed and CREATESCHEDULEDTASK = 1
            </Custom>
            <Custom Action="ApplyModulesRegistryChangeSets" After="InstallFiles">
                NOT Installed
            </Custom>
            <Custom Action="WixCloseApplications" Before="RemoveFiles" />
            <Custom Action="RemovePowerToysSchTasks" After="RemoveFiles" />
            <!-- TODO: Use to activate embedded MSIX -->
            <!--<Custom Action="InstallEmbeddedMSIXTask" After="InstallFinalize">
        NOT Installed
      </Custom>-->
            <Custom Action="TelemetryLogInstallSuccess" After="InstallFinalize">
                NOT Installed
            </Custom>
            <Custom Action="TelemetryLogUninstallSuccess" After="InstallFinalize">
                Installed and (NOT UPGRADINGPRODUCTCODE) AND (REMOVE="ALL")
            </Custom>
            <Custom Action="UnApplyModulesRegistryChangeSets" Before="RemoveFiles">
                Installed AND (REMOVE="ALL")
            </Custom>

            <!-- TODO: Use to activate embedded MSIX -->
            <!--<Custom Action="UninstallEmbeddedMSIXTask" After="InstallFinalize">
        Installed AND (REMOVE="ALL")
      </Custom>-->
            <Custom Action="TerminateProcesses" Before="InstallValidate" />

            <Custom Action="LaunchPowerToys" After="InstallFinalize">NOT Installed</Custom>

        </InstallExecuteSequence>

        <CustomAction
          Id="LaunchPowerToys"
          Execute="immediate"
          Impersonate="yes"
          Return="asyncNoWait"
          FileKey="PowerToys.exe"
          ExeCommand="--dont-elevate" />

        <CustomAction
          Id="TerminateProcesses"
          Return="ignore"
          Execute="immediate"
          BinaryKey="PTCustomActions"
          DllEntry="TerminateProcessesCA" />

        <CustomAction Id="SetRegisterPowerToysSchTaskParam"
                      Property="RegisterPowerToysSchTask"
                      Value="[INSTALLFOLDER]PowerToys.exe" />

        <CustomAction Id="SetApplyModulesRegistryChangeSetsParam"
                        Property="ApplyModulesRegistryChangeSets"
                        Value="[INSTALLFOLDER]" />

        <CustomAction Id="SetUnApplyModulesRegistryChangeSetsParam"
                        Property="UnApplyModulesRegistryChangeSets"
                        Value="[INSTALLFOLDER]" />

        <!-- Needs to Impersonate="no" and Execute="deferred" in order to run elevated. -->
        <CustomAction Id="RegisterPowerToysSchTask"
                      Return="ignore"
                      Impersonate="no"
                      Execute="deferred"
                      BinaryKey="PTCustomActions"
                      DllEntry="CreateScheduledTaskCA"
                   />

        <CustomAction Id="RemovePowerToysSchTasks"
                      Return="ignore"
                      Impersonate="no"
                      Execute="deferred"
                      BinaryKey="PTCustomActions"
                      DllEntry="RemoveScheduledTasksCA"
                   />

        <CustomAction Id="InstallEmbeddedMSIXTask"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="InstallEmbeddedMSIXCA"
                   />

        <CustomAction Id="UninstallEmbeddedMSIXTask"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="UninstallEmbeddedMSIXCA"
                   />

        <CustomAction Id="TelemetryLogInstallSuccess"
                  Return="ignore"
                  Impersonate="yes"
                  BinaryKey="PTCustomActions"
                  DllEntry="TelemetryLogInstallSuccessCA"
                   />

        <CustomAction Id="TelemetryLogInstallCancel"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogInstallCancelCA"
                   />

        <CustomAction Id="TelemetryLogInstallFail"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogInstallFailCA"
                   />

        <CustomAction Id="TelemetryLogUninstallSuccess"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogUninstallSuccessCA"
                   />

        <CustomAction Id="TelemetryLogUninstallCancel"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogUninstallCancelCA"
                   />

        <CustomAction Id="TelemetryLogUninstallFail"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogUninstallFailCA"
                   />

        <CustomAction Id="TelemetryLogRepairCancel"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogRepairCancelCA"
                   />

        <CustomAction Id="TelemetryLogRepairFail"
                      Return="ignore"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="TelemetryLogRepairFailCA"
                   />

        <CustomAction Id="DetectPrevInstallPath"
                      Return="check"
                      Impersonate="yes"
                      BinaryKey="PTCustomActions"
                      DllEntry="DetectPrevInstallPathCA"
                  />

        <CustomAction Id="ApplyModulesRegistryChangeSets"
                      Return="check"
                      Impersonate="yes"
                      Execute="deferred"
                      BinaryKey="PTCustomActions"
                      DllEntry="ApplyModulesRegistryChangeSetsCA"
                  />

        <CustomAction Id="UnApplyModulesRegistryChangeSets"
                      Return="check"
                      Impersonate="yes"
                      Execute="deferred"
                      BinaryKey="PTCustomActions"
                      DllEntry="UnApplyModulesRegistryChangeSetsCA"
                  />


        <!-- Close 'PowerToys.exe' before uninstall-->
        <Property Id="MSIRESTARTMANAGERCONTROL" Value="DisableShutdown" />
        <Property Id="MSIFASTINSTALL" Value="DisableShutdown" />
        <util:CloseApplication CloseMessage="yes" Target="PowerToys.exe" ElevatedCloseMessage="yes" RebootPrompt="no" TerminateProcess="0" />
    </Product>

    <Fragment>
        <Binary Id="PTCustomActions" SourceFile="$(var.PowerToysSetupCustomActions.TargetPath)" />
    </Fragment>

    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="INSTALLFOLDER" Name="PowerToys">
                    <Directory Id="ToolsFolder" Name="Tools"/>
                    <Directory Id="ModulesInstallFolder" Name="modules">
                        <Directory Id="ImageResizerInstallFolder" Name="$(var.ImageResizerProjectName)" />
                        <Directory Id="PowerRenameInstallFolder" Name="$(var.PowerRenameProjectName)">
                            <Directory Id="PowerRenameAssetsFolder" Name="Assets" />
                        </Directory>
                        <Directory Id="ShortcutGuideInstallFolder" Name="ShortcutGuide">
                            <Directory Id="ShortcutGuideExecutableInstallFolder" Name="ShortcutGuide">
                                <Directory Id="ShortcutGuideSvgsInstallFolder" Name="svgs"/>
                            </Directory>
                            <Directory Id="ShortcutGuideModuleInterfaceInstallFolder" Name="ShortcutGuideModuleInterface"/>
                        </Directory>
                        <Directory Id="VideoConferenceInstallFolder" Name="$(var.VideoConferenceProjectName)">
                            <Directory Id="VideoConferenceIconsFolder" Name="Icons" />
                        </Directory>
                        <Directory Id="FileExplorerPreviewInstallFolder" Name="FileExplorerPreview">
                            <Directory Id="MonacoPreviewHandlerMonacoSRCFolder" Name="monacoSRC" />
                            <Directory Id="MonacoPreviewHandlerRuntimesFolder" Name="runtimes">
                                <Directory Id="MonacoPreviewHandlerRuntimesWinX64Folder" Name="win-x64">
                                    <Directory Id="MonacoPreviewHandlerRuntimesWinX64NativeFolder" Name="native" />
                                </Directory>
                            </Directory>
                        </Directory>
                        <Directory Id="FancyZonesInstallFolder" Name="$(var.FancyZonesProjectName)" />
                        <Directory Id="AwakeInstallFolder" Name="$(var.AwakeProjectName)">
                            <Directory Id="AwakeImagesFolder" Name="Images" />
                        </Directory>

                        <!-- KBM -->
                        <Directory Id="KeyboardManagerInstallFolder" Name="$(var.KeyboardManagerProjectName)">
                            <Directory Id="KeyboardManagerEditorInstallFolder" Name="KeyboardManagerEditor" />
                            <Directory Id="KeyboardManagerEngineInstallFolder" Name="KeyboardManagerEngine" />
                        </Directory>

                        <!-- Color Picker -->
                        <Directory Id="ColorPickerInstallFolder" Name="$(var.ColorPickerProjectName)">
                            <Directory Id="ColorPickerResourcesFolder" Name="Resources"/>
                        </Directory>

                        <!-- Mouse Utils -->
                        <Directory Id="MouseUtilsInstallFolder" Name="$(var.MouseUtilsProjectName)">
                        </Directory>

                        <!-- AlwaysOnTop -->
                        <Directory Id="AlwaysOnTopInstallFolder" Name="$(var.AlwaysOnTopProjectName)">
                        </Directory>

                        <!-- Launcher -->
                        <Directory Id="LauncherInstallFolder" Name="launcher">
                            <Directory Id="LauncherImagesFolder" Name="Images" />
                            <Directory Id="LauncherPropertiesFolder" Name="Properties" />

                            <!-- Plugins -->
                            <Directory Id="LauncherPluginsFolder" Name="Plugins">
                                <Directory Id="WebSearchPluginFolder" Name="WebSearch">
                                    <Directory Id="WebSearchImagesFolder" Name="Images" />
                                    <Directory Id="WebSearchLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="CalculatorPluginFolder" Name="Calculator">
                                    <Directory Id="CalculatorImagesFolder" Name="Images" />
                                    <Directory Id="CalculatorLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="FolderPluginFolder" Name="Folder">
                                    <Directory Id="FolderPluginImagesFolder" Name="Images" />
                                    <Directory Id="FolderPluginLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="ProgramPluginFolder" Name="Program">
                                    <Directory Id="ProgramImagesFolder" Name="Images" />
                                    <Directory Id="ProgramLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="ShellPluginFolder" Name="Shell">
                                    <Directory Id="ShellImagesFolder" Name="Images" />
                                    <Directory Id="ShellLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="IndexerPluginFolder" Name="Indexer">
                                    <Directory Id="IndexerImagesFolder" Name="Images" />
                                    <Directory Id="IndexerLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="UriPluginFolder" Name="Uri">
                                    <Directory Id="UriImagesFolder" Name="Images" />
                                    <Directory Id="UriLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="UnitConverterPluginFolder" Name="UnitConverter">
                                    <Directory Id="UnitConverterImagesFolder" Name="Images" />
                                    <Directory Id="UnitConverterLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="VSCodeWorkspacesPluginFolder" Name="VSCodeWorkspace">
                                    <Directory Id="VSCodeWorkspaceImagesFolder" Name="Images" />
                                    <Directory Id="VSCodeWorkspaceLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="WindowWalkerPluginFolder" Name="WindowWalker">
                                    <Directory Id="WindowWalkerImagesFolder" Name="Images" />
                                    <Directory Id="WindowWalkerLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="RegistryPluginFolder" Name="Registry">
                                    <Directory Id="RegistryImagesFolder" Name="Images" />
                                    <Directory Id="RegistryLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="ServicePluginFolder" Name="Service">
                                    <Directory Id="ServiceImagesFolder" Name="Images" />
                                </Directory>
                                <Directory Id="WindowsTerminalPluginFolder" Name="WindowsTerminal">
                                    <Directory Id="WindowsTerminalImagesFolder" Name="Images" />
                                    <Directory Id="WindowsTerminalLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="SystemPluginFolder" Name="System">
                                    <Directory Id="SystemImagesFolder" Name="Images" />
                                </Directory>
								<Directory Id="TimeDatePluginFolder" Name="TimeDate">
                                    <Directory Id="TimeDateImagesFolder" Name="Images" />
                                    <Directory Id="TimeDateLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="TimeZonePluginFolder" Name="TimeZone">
                                    <Directory Id="TimeZoneImagesFolder" Name="Images" />
                                    <Directory Id="TimeZoneLanguagesFolder" Name="Languages" />
                                </Directory>
                                <Directory Id="WindowsSettingsPluginFolder" Name="WindowsSettings">
                                    <Directory Id="WindowsSettingsImagesFolder" Name="Images" />
                                    <Directory Id="WindowsSettingsLanguagesFolder" Name="Languages" />
                                </Directory>
                            </Directory>
                        </Directory>
                    </Directory>

                    <!-- Settings -->
                    <Directory Id="SettingsV2InstallFolder" Name="Settings">
                        <Directory Id="SettingsV2ViewsInstallFolder" Name="Views"/>
                        <Directory Id="SettingsV2StylesInstallFolder" Name="Styles"/>
                        <Directory Id="SettingsV2PropertiesInstallFolder" Name="Properties"/>
                        <Directory Id="SettingsV2AssetsInstallFolder" Name="Assets">
                            <Directory Id="SettingsV2OOBEAssetsFluentIconsInstallFolder" Name="FluentIcons" />
                            <Directory Id="SettingsV2AssetsModulesInstallFolder" Name="Modules" >
                                <Directory Id="SettingsV2OOBEAssetsModulesInstallFolder" Name="OOBE" />
                            </Directory>
                        </Directory>
                        <Directory Id="SettingsV2ControlsInstallFolder" Name="Controls"/>
                        <Directory Id="SettingsV2XamlInstallFolder" Name="Microsoft.UI.Xaml">
                            <Directory Id="SettingsV2XamlAssetsInstallFolder" Name="Assets" />
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="PowerToys (Preview)"/>
            </Directory>
            <Directory Id="DesktopFolder" Name="Desktop" />
        </Directory>
    </Fragment>

    <Fragment>
        <DirectoryRef Id="INSTALLFOLDER" FileSource="$(var.BinX64Dir)">
            <Component Id="powertoys_toast_clsid" Win64="yes">
                <RemoveFolder Id='Remove_powertoys_toast_clsid' On='uninstall' />
                <RegistryKey Root="HKCR" Key="Software\Classes\CLSID\{DD5CACDA-7C2E-4997-A62A-04A597B58F76}">
                    <RegistryValue Type="string" Value="PowerToys Toast Notifications Background Activator" />
                    <RegistryValue Type="string" Key="LocalServer32" Value="[INSTALLFOLDER]PowerToys.exe -ToastActivated" />
                    <RegistryValue Type="string" Key="LocalServer32" Name="ThreadingModel" Value="Apartment" />
                </RegistryKey>
            </Component>
            <Component Id="powertoys_exe" Win64="yes">
                <File Id="PowerToys.exe" KeyPath="yes" Checksum="yes" />
                <RegistryKey Root="HKLM" Key="Software\Classes\powertoys">
                    <RegistryValue Type="string" Name="URL Protocol" Value=""/>
                    <RegistryValue Type="string" Value="URL:PowerToys custom internal URI protocol"/>
                    <RegistryKey Key="DefaultIcon">
                        <RegistryValue Type="string" Value="PowerToys.exe" />
                    </RegistryKey>
                    <RegistryKey Key="shell\open\command">
                        <RegistryValue Type="string" Value="&quot;[INSTALLFOLDER]PowerToys.exe&quot; &quot;%1&quot;" />
                    </RegistryKey>
                </RegistryKey>
            </Component>
            <Component Id="BackgroundActivator_dll" Win64="yes">
                <File Id="PowerToys.BackgroundActivatorDLL.dll" KeyPath="yes" Checksum="yes" />
            </Component>
            <Component Id="PowerToys_ActionRunner_exe" Win64="yes">
                <File Id="PowerToys.ActionRunner.exe" KeyPath="yes" Checksum="yes" />
            </Component>
            <Component Id="PowerToys_Update_exe" Win64="yes">
                <File Id="PowerToys.Update.exe" KeyPath="yes" Checksum="yes" />
            </Component>
            <Component Id="License_rtf" Win64="yes">
                <File Source="$(var.RepoDir)\installer\License.rtf" Id="License.rtf" KeyPath="yes" />
            </Component>
            <Component Id="Notice_md" Win64="yes">
                <File Source="$(var.RepoDir)\Notice.md" Id="Notice.md" KeyPath="yes" />
            </Component>
            <Component Id="powertoysinterop_dll" Win64="yes">
                <File Id="PowerToys.Interop.dll" KeyPath="yes" Checksum="yes" />
            </Component>
            <Component Id="vcredist_dlls" Guid="2CCA6607-3BE0-48FE-8617-AABE5B7F6843" Win64="yes">
                <!-- VCRuntime -->
			    <!-- !Warning! Make sure to change Component Guid if you update the file list -->
                <?foreach File in vcruntime140.dll;vcruntime140_1.dll;concrt140.dll;msvcp140.dll;msvcp140_1.dll;msvcp140_2.dll;msvcp140_codecvt_ids.dll;vccorlib140.dll?>
                <File Id="$(var.File)" Source="$(var.RepoDir)installer\VCRuntime\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="PowerToysStartMenuShortcut" >
                <Shortcut Id="ApplicationStartMenuShortcut"
                Name="PowerToys (Preview)"
                Description="PowerToys - Windows system utilities to maximize productivity"
                Icon="powertoys.exe"
                IconIndex="0"
                Target="[!PowerToys.exe]"
                WorkingDirectory="INSTALLFOLDER">
                    <ShortcutProperty Key="System.AppUserModel.ID" Value="Microsoft.PowerToysWin32"/>
                </Shortcut>
                <RemoveFolder Id="CleanUpStartMenuShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
                <!-- ApplicationStartMenuShortcut is implicitly installed in HKCU, so WIX won't allow changing this reg value to HKLM. -->
                <RegistryValue Root="HKCU" Key="Software\Microsoft\PowerToys" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>

        <!-- Shortcut guide files -->
        <DirectoryRef Id="ShortcutGuideSvgsInstallFolder" FileSource="$(var.ShortcutGuideExecutable)\svgs\">
            <?foreach File in $(var.ShortcutGuideSvgsFiles)?>
            <Component Id="ShortcutGuideSvgs_$(var.File)" Win64="yes">
                <File Source="$(var.ShortcutGuideExecutable)\svgs\$(var.File)" />
            </Component>
            <?endforeach?>
        </DirectoryRef>

        <!-- FancyZone -->
        <DirectoryRef Id="FancyZonesInstallFolder" FileSource="$(var.BinX64Dir)modules\">
			      <?foreach File in $(var.FancyZonesFiles)?>
                <Component Id="Module_FancyZones_$(var.File)" Win64="yes">
                    <File Id="Module_FancyZones_File_$(var.File)" Source="$(var.BinX64Dir)modules\$(var.FancyZonesProjectName)\$(var.File)" />
                </Component>
            <?endforeach?>
        </DirectoryRef>

        <DirectoryRef Id="ToolsFolder">
            <Component Id="BugReportTool_exe" Win64="yes">
                <File Source="$(var.BinX64Dir)BugReportTool\PowerToys.BugReportTool.exe" Id="BugReportTool.exe" KeyPath="yes" Checksum="yes" />
            </Component>
            <Component Id="WebcamReportTool_exe" Win64="yes">
                <File Source="$(var.BinX64Dir)WebcamReportTool\PowerToys.WebcamReportTool.exe" Id="WebcamReportTool.exe" Checksum="yes" />
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="ModulesInstallFolder" FileSource="$(var.BinX64Dir)modules\">
            <Component Id="Module_PowerPreview_Registry" Win64="yes">
                <!-- Update Key to use IE11 for prevhost.exe -->
                <RegistryKey Root="HKLM" Key="Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_BROWSER_EMULATION">
                    <RegistryValue Type="integer" Name="prevhost.exe" Value="11000" />
                </RegistryKey>
                <!-- Update Key to use IE11 for dllhost.exe -->
                <RegistryKey Root="HKLM" Key="Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_BROWSER_EMULATION">
                    <RegistryValue Type="integer" Name="dllhost.exe" Value="11000" />
                </RegistryKey>
            </Component>
        </DirectoryRef>

        <!-- Image Resizer -->
        <DirectoryRef Id="ImageResizerInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.ImageResizerProjectName)">
            <?foreach File in $(var.ImageResizerFiles)?>
                <Component Id="Module_ImageResizer_$(var.File)" Win64="yes">
                    <File Id="Module_ImageResizer_File_$(var.File)" Source="$(var.BinX64Dir)modules\$(var.ImageResizerProjectName)\$(var.File)" />
                </Component>
            <?endforeach?>
            <Component Id="Module_ImageResizer_vcredist_dlls" Win64="yes" Guid="52F2C34D-6F45-44B4-9718-2FDFBC2373B8">
                <!-- VCRuntime -->
			    <!-- !Warning! Make sure to change Component Guid if you update the file list -->
                <?foreach File in vcruntime140.dll;vcruntime140_1.dll;concrt140.dll;msvcp140.dll;msvcp140_1.dll;msvcp140_2.dll;msvcp140_codecvt_ids.dll;vccorlib140.dll?>
                <File Id="ImageResizer_$(var.File)" Source="$(var.RepoDir)installer\VCRuntime\$(var.File)" />
                <?endforeach?>
            </Component>
            <Component Id="Module_ImageResizer_Registry" Win64="yes">
                <RegistryKey Root="HKLM" Key="Software\Classes\CLSID\{51B4D7E5-7568-4234-B4BB-47FB3C016A69}\InprocServer32">
                    <RegistryValue Value="[ImageResizerInstallFolder]PowerToys.ImageResizerExt.dll" Type="string" />
                    <RegistryValue Name="ThreadingModel" Value="Apartment" Type="string" />
                </RegistryKey>

                <!-- Registry Key for the drag and drop handler -->
                <!-- To use later on when we want to install per user.
                <RegistryValue Root="HKCU"
                               Key="Software\Classes\Directory\ShellEx\DragDropHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                               -->
                <RegistryValue Root="HKCR"
                               Key="Directory\ShellEx\DragDropHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
              <!-- Registry Keys for the context menu handler for each of the following image formats: bmp, dib, gif, jfif, jpe, jpeg, jpg, jxr, png, rle, tif, tiff, wdp  -->
              <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.bmp\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.dib\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.gif\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.jfif\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.jpe\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.jpeg\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.jpg\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.jxr\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.png\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.rle\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.tif\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.tiff\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
                <RegistryValue Root="HKCR"
                               Key="SystemFileAssociations\.wdp\ShellEx\ContextMenuHandlers\ImageResizer"
                               Value="{51B4D7E5-7568-4234-B4BB-47FB3C016A69}"
                               Type="string" />
            </Component>
        </DirectoryRef>

        <!-- PowerRename -->
        <DirectoryRef Id="PowerRenameInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.PowerRenameProjectName)">
            <?foreach File in $(var.PowerRenameFiles)?>
                <Component Id="PowerRename_$(var.File)" Win64="yes">
                    <File Source="$(var.BinX64Dir)modules\$(var.PowerRenameProjectName)\$(var.File)" />
                </Component>
            <?endforeach?>        
			<!-- !Warning! Make sure to change Component Guid if you update something here -->
            <Component Id="Module_PowerRename" Guid="40D43079-240E-402D-8CE8-571BFFA71175" Win64="yes">
                <!-- VCRuntime -->
                <?foreach File in vcruntime140.dll;vcruntime140_1.dll;concrt140.dll;msvcp140.dll;msvcp140_1.dll;msvcp140_2.dll;msvcp140_codecvt_ids.dll;vccorlib140.dll?>
                <File Id="PowerRename_$(var.File)" Source="$(var.RepoDir)installer\VCRuntime\$(var.File)" />
                <?endforeach?>
                <RegistryKey Root="HKLM" Key="Software\Classes\CLSID\{0440049F-D1DC-4E46-B27B-98393D79486B}">
                    <RegistryValue Type="string" Value="PowerRename Shell Extension" />
                    <RegistryValue Type="string" Name="ContextMenuOptIn" Value="" />
                    <RegistryValue Type="string" Key="InprocServer32" Value="[PowerRenameInstallFolder]PowerToys.PowerRenameExt.dll" />
                    <RegistryValue Type="string" Key="InprocServer32" Name="ThreadingModel" Value="Apartment" />
                </RegistryKey>
                <RegistryKey Root="HKLM" Key="Software\Classes\AllFileSystemObjects\ShellEx\ContextMenuHandlers\PowerRenameExt">
                    <RegistryValue Type="string" Value="{0440049F-D1DC-4E46-B27B-98393D79486B}"/>
                </RegistryKey>
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="PowerRenameAssetsFolder" FileSource="$(var.BinX64Dir)modules\$(var.PowerRenameProjectName)">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="Module_PowerRename_Assets" Guid="BA290033-7861-44B7-8A04-7E4C3CC7F0AE" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.PowerRenameProjectName)\Assets\file.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.PowerRenameProjectName)\Assets\folder.png" />
            </Component>
        </DirectoryRef>
        <!-- MouseUtils -->
        <DirectoryRef Id="MouseUtilsInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.MouseUtilsProjectName)">
            <Component Id="Module_FindMyMouse" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.MouseUtilsProjectName)\PowerToys.FindMyMouse.dll" KeyPath="yes" />
            </Component>
            <Component Id="Module_MouseHighlighter" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.MouseUtilsProjectName)\PowerToys.MouseHighlighter.dll" KeyPath="yes" />
            </Component>
            <Component Id="Module_MousePointerCrosshairs" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.MouseUtilsProjectName)\PowerToys.MousePointerCrosshairs.dll" KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <!-- Shortcut guide -->
        <DirectoryRef Id="ShortcutGuideModuleInterfaceInstallFolder" FileSource="$(var.ShortcutGuideModuleInterface)">
            <Component Id="Module_ShortcutGuideModuleInterface" Win64="yes">
                <File Source="$(var.ShortcutGuideModuleInterface)\PowerToys.ShortcutGuideModuleInterface.dll" KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="VideoConferenceInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="Module_VideoConference" Guid="21DA4677-4AE8-4F01-BFC9-448E338DF864" Win64="yes">
                <Condition>WINDOWSBUILDNUMBER >= 18362</Condition>
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\PowerToys.VideoConferenceProxyFilter_x64.dll" KeyPath="yes" />
                <File Source="$(var.BinX32Dir)modules\$(var.VideoConferenceProjectName)\PowerToys.VideoConferenceProxyFilter_x86.dll" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\PowerToys.VideoConferenceModule.dll" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="VideoConferenceIconsFolder" FileSource="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="Module_VideoConferenceIcons" Guid="9910F3D9-1BDF-43DB-BA0C-C558B121DF18" Win64="yes">
                <Condition>WINDOWSBUILDNUMBER >= 18362</Condition>
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-NotInUse Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-NotInUse Light.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-Off Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-Off Light.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-On Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\Off-On Light.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-NotInUse Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-NotInUse Light.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-Off Light.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-Off Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-On Dark.png" />
                <File Source="$(var.BinX64Dir)modules\$(var.VideoConferenceProjectName)\Icons\On-On Light.png" />
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="ShortcutGuideExecutableInstallFolder" FileSource="$(var.ShortcutGuideExecutable)">
            <Component Id="Module_ShortcutGuideExecutable" Win64="yes">
                <File Source="$(var.ShortcutGuideExecutable)\PowerToys.ShortcutGuide.exe" KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <!-- KBM -->
        <DirectoryRef Id="KeyboardManagerInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\">
            <Component Id="Module_KeyboardManager" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\PowerToys.KeyboardManager.dll" />
            </Component>
        </DirectoryRef>

        <!-- KBM Editor -->
        <DirectoryRef Id="KeyboardManagerEditorInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\KeyboardManagerEditor">
            <Component Id="Module_KeyboardManager_Editor" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\KeyboardManagerEditor\PowerToys.KeyboardManagerEditor.exe" />
            </Component>
        </DirectoryRef>

        <!-- KBM Engine -->
        <DirectoryRef Id="KeyboardManagerEngineInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\KeyboardManagerEngine">
            <Component Id="Module_KeyboardManager_Engine" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.KeyboardManagerProjectName)\KeyboardManagerEngine\PowerToys.KeyboardManagerEngine.exe" />
            </Component>
        </DirectoryRef>

        <!-- Color Picker -->
        <DirectoryRef Id="ColorPickerInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="Module_ColorPicker" Guid="C15076EC-70EE-4CE9-BEA0-665B1EECCAAF" Win64="yes">
                <?foreach File in PowerToys.ColorPicker.dll;System.IO.Abstractions.dll;PowerToys.ColorPickerUI.exe;PowerToys.ColorPickerUI.dll;PowerToys.ColorPickerUI.deps.json;PowerToys.ColorPickerUI.runtimeconfig.json;PowerToys.Settings.UI.Lib.dll;PowerToys.Interop.dll;PowerToys.ManagedTelemetry.dll;PowerToys.ManagedCommon.dll;ControlzEx.dll;Microsoft.Xaml.Behaviors.dll;ModernWpf.Controls.dll;ModernWpf.dll;System.ComponentModel.Composition.dll;PowerToys.Common.UI.dll;WinRT.Runtime.dll;Microsoft.Windows.SDK.NET.dll;System.Text.Json.dll?>
                <File Id="ColorPickerFile_$(var.File)" Source="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>

        <!-- Color Picker Resources -->
        <DirectoryRef Id="ColorPickerResourcesFolder" FileSource="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)\Resources">
            <Component Id="Module_ColorPicker_Cursor">
                <File Id="ColorPickerFile_colorPicker.cur" Source="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)\Resources\colorPicker.cur" />
            </Component>
			<Component Id="Module_ColorPicker_Icon">
				<File Id="ColorPickerFile_icon.ico" Source="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)\Resources\icon.ico" />
			</Component>
		</DirectoryRef>

        <!-- Awake -->
        <DirectoryRef Id="AwakeInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.AwakeProjectName)">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="Module_Awake" Guid="0D571D9A-743B-4CC5-9297-F0289FBE3398" Win64="yes">
                <?foreach File in PowerToys.AwakeModuleInterface.dll;PowerToys.ManagedCommon.dll;PowerToys.ManagedTelemetry.dll;PowerToys.Settings.UI.Lib.dll;NLog.config;NLog.dll;PowerToys.Awake.deps.json;PowerToys.Awake.dll;PowerToys.Awake.exe;PowerToys.Awake.runtimeconfig.json;PowerToys.Interop.dll;System.CommandLine.dll;System.IO.Abstractions.dll;System.Reactive.dll;System.Runtime.Caching.dll;System.Text.Json.dll?>
                <File Id="AwakeFile_$(var.File)" Source="$(var.BinX64Dir)modules\$(var.AwakeProjectName)\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>

        <!-- Awake images -->
        <DirectoryRef Id="AwakeImagesFolder" FileSource="$(var.BinX64Dir)modules\$(var.AwakeProjectName)\Images">
            <Component Id="Module_Awake_Images" >
                <File Id="Awake_Awake.ico" Source="$(var.BinX64Dir)modules\$(var.AwakeProjectName)\Images\Awake.ico" />
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="FileExplorerPreviewInstallFolder" FileSource="$(var.RepoDir)\modules\FileExplorerPreview\">
            <?foreach File in $(var.PowerPreviewFiles)?>
                <Component Id="Module_PowerPreview_$(var.File)" Win64="yes">
                    <File Id="$(var.File)" Source="$(var.BinX64Dir)modules\FileExplorerPreview\$(var.File)" />
                </Component>
            <?endforeach?>
        </DirectoryRef>
        <DirectoryRef Id="MonacoPreviewHandlerRuntimesWinX64NativeFolder" FileSource="$(var.BinX64Dir)modules\FileExplorerPreview\runtimes\win-x64\native">
            <Component Id="MonacoPreviewHandlerRuntimesWinX64NativeLibs" Win64="yes">
                <File Id="MonacoPreviewHandler_WebView2Loader" Source="$(var.BinX64Dir)modules\FileExplorerPreview\runtimes\win-x64\native\WebView2Loader.dll" />
            </Component>
        </DirectoryRef>

        <!-- AlwaysOnTop -->
        <DirectoryRef Id="AlwaysOnTopInstallFolder" FileSource="$(var.BinX64Dir)modules\$(var.AlwaysOnTopProjectName)">
            <Component Id="Module_AlwaysOnTopInterface" Win64="yes">
                <File Source="$(var.BinX64Dir)modules\$(var.AlwaysOnTopProjectName)\PowerToys.AlwaysOnTopModuleInterface.dll" />
            </Component>
			<Component Id="Module_AlwaysOnTop" Win64="yes">
				<File Source="$(var.BinX64Dir)modules\$(var.AlwaysOnTopProjectName)\PowerToys.AlwaysOnTop.exe" />
			</Component>
			
        </DirectoryRef>

        <!-- SettingsV2 components -->
        <DirectoryRef Id="SettingsV2InstallFolder" FileSource="$(var.BinX64Dir)Settings\">
            <?foreach File in $(var.SettingsV2Files)?>
                <Component Id="SettingsV2_$(var.File)" Win64="yes">
                    <File Id="SV2_$(var.File)" Source="$(var.BinX64Dir)Settings\$(var.File)" />
                </Component>
            <?endforeach?>
            <Component Id="SettingsV2_Redist" Win64="yes" Guid="AB8C3CAE-3390-48E8-B2E1-36003E1FDEB3">            
                <!-- !Warning! Make sure to change Component Guid if you update the file list -->
                <!-- VCRuntime -->
                <?foreach File in vcruntime140.dll;vcruntime140_1.dll;concrt140.dll;msvcp140.dll;msvcp140_1.dll;msvcp140_2.dll;msvcp140_codecvt_ids.dll;vccorlib140.dll?>
                <File Id="SettingsV2_$(var.File)" Source="$(var.RepoDir)installer\VCRuntime\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2AssetsInstallFolder" FileSource="$(var.BinX64Dir)Settings\Assets">
            <Component Id="SettingsV2Assets_LogoScale200" Win64="yes">
                <File Id="SV2A_LogoScale200" Source="$(var.BinX64Dir)Settings\Assets\Logo.scale-200.png" />
            </Component>
            <Component Id="SettingsV2Assets_SplashScreen" Win64="yes">
                <File Id="SV2A_SplashScreen" Source="$(var.BinX64Dir)Settings\Assets\SplashScreen.png" />
            </Component>
            <Component Id="SettingsV2Assets_StoreLogo_Scale100" Win64="yes">
                <File Id="SV2A_StoreLogoScale100" Source="$(var.BinX64Dir)Settings\Assets\StoreLogo.scale-100.png" />
            </Component>
            <Component Id="SettingsV2Assets_StoreLogo" Win64="yes">
                <File Id="SV2A_StoreLogo" Source="$(var.BinX64Dir)Settings\Assets\StoreLogo.png" />
            </Component>
            <Component Id="SettingsV2Assets_Square150x150sc200" Win64="yes">
                <File Id="SV2A_Square150x150sc200" Source="$(var.BinX64Dir)Settings\Assets\Square150x150Logo.scale-200.png" />
            </Component>
            <Component Id="SettingsV2Assets_Square44x44ts24" Win64="yes">
                <File Id="SV2A_Square44x44ts24" Source="$(var.BinX64Dir)Settings\Assets\Square44x44Logo.targetsize-24_altform-unplated.png" />
            </Component>
            <Component Id="SettingsV2Assets_Wide310x150sc200" Win64="yes">
                <File Id="SV2A_Wide310x150sc200" Source="$(var.BinX64Dir)Settings\Assets\Wide310x150Logo.scale-200.png" />
            </Component>
            <Component Id="SettingsV2Assets_Square44x44Logo200" Win64="yes">
                <File Id="SV2A_Square44x44Logo200" Source="$(var.BinX64Dir)Settings\Assets\Square44x44Logo.scale-200.png" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2AssetsModulesInstallFolder" FileSource="$(var.BinX64Dir)Settings\Assets\Modules">
			<?foreach File in $(var.SettingsV2AssetsModulesFiles)?>
			    <Component Id="SettingsV2AssetsModules_$(var.File)" Win64="yes">
				    <File Id="S2AMF_$(var.File)" Source="$(var.BinX64Dir)Settings\Assets\Modules\$(var.File)" />
			    </Component>
			<?endforeach?>
		</DirectoryRef>
        <DirectoryRef Id="SettingsV2OOBEAssetsModulesInstallFolder" FileSource="$(var.BinX64Dir)Settings\Assets\Modules\OOBE">
			<?foreach File in $(var.SettingsV2OOBEAssetsModulesFiles)?>
			    <Component Id="SettingsV2OOBEAssetsModules_$(var.File)" Win64="yes">
				    <File Id="SettingsV2OOBEAssetsModules_$(var.File)"  Source="$(var.BinX64Dir)Settings\Assets\Modules\OOBE\$(var.File)" />
			    </Component>
			<?endforeach?>
		</DirectoryRef>
        <DirectoryRef Id="SettingsV2OOBEAssetsFluentIconsInstallFolder" FileSource="$(var.BinX64Dir)Settings\Assets\FluentIcons">
			<?foreach File in $(var.SettingsV2OOBEAssetsFluentIconsFiles)?>
			    <Component Id="SettingsV2OOBEAssetsFluentIcons_$(var.File)" Win64="yes">
				    <File Id="SettingsV2OOBEAssetsFluentIconsFile_$(var.File)" Source="$(var.BinX64Dir)Settings\Assets\FluentIcons\FluentIcons$(var.File)" />
			    </Component>
			<?endforeach?>			
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2ControlsInstallFolder" FileSource="$(var.BinX64Dir)Settings\Controls\ShortcutControl">
            <Component Id="SettingsV2Controls" Win64="yes">
                <?foreach File in ShortcutControl.xbf?>
                <File Id="SettingsV2_Controls_$(var.File)" Source="$(var.BinX64Dir)Settings\Controls\ShortcutControl\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2PropertiesInstallFolder" FileSource="$(var.BinX64Dir)Settings\Properties">
            <Component Id="SettingsV2Properties" Win64="yes">
                <?foreach File in Default.rd.xml?>
                <File Id="SettingsV2_Properties_$(var.File)" Source="$(var.BinX64Dir)Settings\Properties\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2StylesInstallFolder" FileSource="$(var.BinX64Dir)Settings\Styles">
			<?foreach File in $(var.SettingsV2StylesFiles)?>
			    <Component Id="SettingsV2Styles_$(var.File)" Win64="yes">
				    <File Id="SettingsV2StylesFile_$(var.File)" Source="$(var.BinX64Dir)Settings\Styles\$(var.File)" />
			    </Component>
			<?endforeach?>
		</DirectoryRef>
        <DirectoryRef Id="SettingsV2ViewsInstallFolder" FileSource="$(var.BinX64Dir)Settings\Views">
			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="SettingsV2Views" Guid="2FEAE191-C924-4340-9292-F18FB8C30D66" Win64="yes">
                <?foreach File in FancyZonesPage.xbf;GeneralPage.xbf;ImageResizerPage.xbf;KeyboardManagerPage.xbf;PowerLauncherPage.xbf;PowerPreviewPage.xbf;PowerRenamePage.xbf;ShellPage.xbf;ShortcutGuidePage.xbf?>
                <File Id="SettingsV2_Views_$(var.File)" Source="$(var.BinX64Dir)Settings\Views\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="SettingsV2XamlAssetsInstallFolder" FileSource="$(var.BinX64Dir)Settings\Microsoft.UI.Xaml\Assets">
            <Component Id="SettingsV2XamlAssets" Win64="yes">
                <?foreach File in NoiseAsset_256X256_PNG.png?>
                <File Id="SettingsV2_XamlAssets_$(var.File)" Source="$(var.BinX64Dir)Settings\Microsoft.UI.Xaml\Assets\$(var.File)" />
                <?endforeach?>
            </Component>
        </DirectoryRef>

        <DirectoryRef Id="DesktopFolder">
            <Component Id="DesktopShortcut" >
                <Condition>INSTALLDESKTOPSHORTCUT</Condition>
                <!-- DesktopShortcutId is implicitly installed in HKCU, so WIX won't allow changing this reg value to HKLM. -->
                <RegistryValue Root="HKCU"
                                Key="Software\[Manufacturer]\[ProductName]"
                                Name="desktopshorcutinstalled"
                                Type="integer"
                                Value="1"
                                KeyPath="yes"/>
                <Shortcut Id="DesktopShortcutId"
                          Name="PowerToys (Preview)"
                          Description="PowerToys - Windows system utilities to maximize productivity"
                          Target="[!PowerToys.exe]"
                          WorkingDirectory="INSTALLFOLDER"
                          Icon="powertoys.exe"
                          Directory="DesktopFolder"/>
            </Component>
        </DirectoryRef>
    </Fragment>

    <Fragment>
        <ComponentGroup Id="CoreComponents" Directory="INSTALLFOLDER">
            <ComponentRef Id="powertoys_exe" />
            <ComponentRef Id="PowerToysStartMenuShortcut"/>
            <ComponentRef Id="BackgroundActivator_dll" />
            <ComponentRef Id="PowerToys_ActionRunner_exe" />
            <ComponentRef Id="PowerToys_Update_exe" />
            <ComponentRef Id="powertoys_toast_clsid" />
            <ComponentRef Id="License_rtf" />
            <ComponentRef Id="Notice_md" />
            <ComponentRef Id="powertoysinterop_dll" />
            <ComponentRef Id="vcredist_dlls" />
			<?foreach File in $(var.ShortcutGuideSvgsFiles)?>
			    <ComponentRef Id="ShortcutGuideSvgs_$(var.File)" />
			<?endforeach?>
            <ComponentRef Id="Module_ShortcutGuideModuleInterface" />
            <ComponentRef Id="Module_ShortcutGuideExecutable" />
            <ComponentRef Id="Module_VideoConference" />
            <ComponentRef Id="Module_VideoConferenceIcons" />
            <?foreach File in $(var.FancyZonesFiles)?>
                <ComponentRef Id="Module_FancyZones_$(var.File)" />
            <?endforeach?>
            <ComponentRef Id="DesktopShortcut" />
            <ComponentRef Id="Module_PowerRename" />
			<?foreach File in $(var.PowerRenameFiles)?>
			    <ComponentRef Id="PowerRename_$(var.File)" />
			<?endforeach?>
			<ComponentRef Id="Module_PowerRename_Assets" />
            <?foreach File in $(var.ImageResizerFiles)?>
                <ComponentRef Id="Module_ImageResizer_$(var.File)" />
            <?endforeach?>                
            <ComponentRef Id="Module_ImageResizer_vcredist_dlls" />
            <ComponentRef Id="Module_ImageResizer_Registry" />
            <?foreach File in $(var.PowerPreviewFiles)?>
                <ComponentRef Id="Module_PowerPreview_$(var.File)" />
            <?endforeach?>                
            <ComponentRef Id="MonacoPreviewHandlerRuntimesWinX64NativeLibs" />
            <ComponentRef Id="Module_PowerPreview_Registry" />
            <ComponentRef Id="Module_KeyboardManager" />
            <ComponentRef Id="Module_KeyboardManager_Editor" />
            <ComponentRef Id="Module_KeyboardManager_Engine" />
            <ComponentRef Id="Module_ColorPicker" />
            <ComponentRef Id="Module_ColorPicker_Icon"/>
			<ComponentRef Id="Module_ColorPicker_Cursor"/>
            <ComponentRef Id="Module_Awake"/>
            <ComponentRef Id="Module_Awake_Images"/>
            <ComponentRef Id="Module_FindMyMouse"/>
            <ComponentRef Id="Module_MouseHighlighter"/>
            <ComponentRef Id="Module_MousePointerCrosshairs" />
            <ComponentRef Id="Module_AlwaysOnTop"/>
			<ComponentRef Id="Module_AlwaysOnTopInterface"/>
            <?foreach File in $(var.SettingsV2Files)?>
                <ComponentRef Id="SettingsV2_$(var.File)" />
            <?endforeach?>                
            <ComponentRef Id="SettingsV2Assets_LogoScale200" />
            <ComponentRef Id="SettingsV2Assets_SplashScreen" />
            <ComponentRef Id="SettingsV2Assets_StoreLogo_Scale100" />
            <ComponentRef Id="SettingsV2Assets_StoreLogo" />
            <ComponentRef Id="SettingsV2Assets_Square150x150sc200" />
            <ComponentRef Id="SettingsV2Assets_Square44x44ts24" />
            <ComponentRef Id="SettingsV2Assets_Wide310x150sc200" />
            <ComponentRef Id="SettingsV2Assets_Square44x44Logo200" />            
            <ComponentRef Id="SettingsV2_Redist" />
			<?foreach File in $(var.SettingsV2AssetsModulesFiles)?>
			    <ComponentRef Id="SettingsV2AssetsModules_$(var.File)" />
			<?endforeach?>
			<?foreach File in $(var.SettingsV2OOBEAssetsFluentIconsFiles)?>
			    <ComponentRef Id="SettingsV2OOBEAssetsFluentIcons_$(var.File)" />
			<?endforeach?>
			<?foreach File in $(var.SettingsV2OOBEAssetsModulesFiles)?>
                <ComponentRef Id="SettingsV2OOBEAssetsModules_$(var.File)" />
            <?endforeach?>
            <ComponentRef Id="SettingsV2Controls" />
            <ComponentRef Id="SettingsV2Properties" />
			<?foreach File in $(var.SettingsV2StylesFiles)?>
			    <ComponentRef Id="SettingsV2Styles_$(var.File)" />
			<?endforeach?>
			<ComponentRef Id="SettingsV2Views" />
            <ComponentRef Id="SettingsV2XamlAssets" />
        </ComponentGroup>
        <ComponentGroup Id="ToolComponents" Directory="ToolsFolder">
            <ComponentRef Id="BugReportTool_exe" />
            <ComponentRef Id="WebcamReportTool_exe" />
        </ComponentGroup>
    </Fragment>

    <!-- Languages for localization on build farm -->
    <!-- qps-ploc;qps-ploca;qps-plocm; -->
    <?define LocLanguageList = cs-CZ;de-DE;es-ES;fr-FR;hu-HU;it-IT;ja-JP;ko-KR;nl-NL;pl-PL;pt-BR;pt-PT;ru-RU;sv-SE;tr-TR;zh-CN;zh-TW?>

    <Fragment>
        <!-- Resource directories should be added only if the installer is built on the build farm -->
        <?ifdef env.IsPipeline?>
        <?foreach ParentDirectory in LauncherInstallFolder;FancyZonesInstallFolder;ImageResizerInstallFolder;ColorPickerInstallFolder;FileExplorerPreviewInstallFolder;CalculatorPluginFolder;FolderPluginFolder;ProgramPluginFolder;ShellPluginFolder;IndexerPluginFolder;UnitConverterPluginFolder;UriPluginFolder;WindowWalkerPluginFolder;RegistryPluginFolder;VSCodeWorkspacesPluginFolder;ServicePluginFolder;SystemPluginFolder;TimeDatePluginFolder;TimeZonePluginFolder;WindowsSettingsPluginFolder;WindowsTerminalPluginFolder;WebSearchPluginFolder?>
        <DirectoryRef Id="$(var.ParentDirectory)">
            <!-- Resource file directories -->
            <?foreach Language in $(var.LocLanguageList)?>
            <!--NB: Ids can't contain hyphens-->
            <?if $(var.Language) = cs-CZ?>
            <?define IdSafeLanguage = cs_CZ?>
            <?elseif $(var.Language) = de-DE?>
            <?define IdSafeLanguage = de_DE?>
            <?elseif $(var.Language) = es-ES?>
            <?define IdSafeLanguage = es_ES?>
            <?elseif $(var.Language) = fr-FR?>
            <?define IdSafeLanguage = fr_FR?>
            <?elseif $(var.Language) = hu-HU?>
            <?define IdSafeLanguage = hu_HU?>
            <?elseif $(var.Language) = it-IT?>
            <?define IdSafeLanguage = it_IT?>
            <?elseif $(var.Language) = ja-JP?>
            <?define IdSafeLanguage = ja_JP?>
            <?elseif $(var.Language) = ko-KR?>
            <?define IdSafeLanguage = ko_KR?>
            <?elseif $(var.Language) = nl-NL?>
            <?define IdSafeLanguage = nl_NL?>
            <?elseif $(var.Language) = pl-PL?>
            <?define IdSafeLanguage = pl_PL?>
            <?elseif $(var.Language) = pt-BR?>
            <?define IdSafeLanguage = pt_BR?>
            <?elseif $(var.Language) = pt-PT?>
            <?define IdSafeLanguage = pt_PT?>
<!--

            <?elseif $(var.Language) = qps-ploc?>
            <?define IdSafeLanguage = qps_ploc?>
            <?elseif $(var.Language) = qps-ploca?>
            <?define IdSafeLanguage = qps_ploca?>
            <?elseif $(var.Language) = qps-plocm?>
            <?define IdSafeLanguage = qps_plocm?>
-->
            <?elseif $(var.Language) = ru-RU?>
            <?define IdSafeLanguage = ru_RU?>
            <?elseif $(var.Language) = sv-SE?>
            <?define IdSafeLanguage = sv_SE?>
            <?elseif $(var.Language) = tr-TR?>
            <?define IdSafeLanguage = tr_TR?>
            <?elseif $(var.Language) = zh-CN?>
            <?define IdSafeLanguage = zh_CN?>
            <?elseif $(var.Language) = zh-TW?>
            <?define IdSafeLanguage = zh_TW?>
            <?else?>
            <?define IdSafeLanguage = $(var.Language)?>
            <?endif?>
            <Directory Id="Resource$(var.IdSafeLanguage)$(var.ParentDirectory)" Name="$(var.Language)" />
            <?undef IdSafeLanguage?>
            <?endforeach?>
        </DirectoryRef>
        <?endforeach?>
        <?endif?>
        <ComponentGroup Id="ResourcesComponents">
            <!-- Resource components should be added only if the installer is built on the build farm -->
            <?ifdef env.IsPipeline?>
            <!-- Components for adding resource files -->
            <?foreach Language in $(var.LocLanguageList)?>
            <!--NB: Ids can't contain hyphens-->
            <?if $(var.Language) = cs-CZ?>
            <!-- CompGUIDPrefix is language-dependent guid prefix missing the last 2 digits. -->
            <?define CompGUIDPrefix = 3E93405A-B91B-4E04-BAEC-26BEEE60F9?>
            <?define IdSafeLanguage = cs_CZ?>
            <?elseif $(var.Language) = de-DE?>
            <?define CompGUIDPrefix = AF28C057-7ED9-474C-8E7E-D583BE8ECF?>
            <?define IdSafeLanguage = de_DE?>
            <?elseif $(var.Language) = es-ES?>
            <?define CompGUIDPrefix = DD1FEEBD-55F0-44BA-A0FF-62C5C1C952?>
            <?define IdSafeLanguage = es_ES?>
            <?elseif $(var.Language) = fr-FR?>
            <?define CompGUIDPrefix = F9F86D61-C747-43FC-8509-F3D1F198E1?>
            <?define IdSafeLanguage = fr_FR?>
            <?elseif $(var.Language) = hu-HU?>
            <?define CompGUIDPrefix = 9A919A40-E457-47F5-97C8-E886F06DDE?>
            <?define IdSafeLanguage = hu_HU?>
            <?elseif $(var.Language) = it-IT?>
            <?define CompGUIDPrefix = 48FBF6D9-32DB-46FF-A64C-225269E738?>
            <?define IdSafeLanguage = it_IT?>
            <?elseif $(var.Language) = ja-JP?>
            <?define CompGUIDPrefix = FB8E04AB-C8E8-43C0-8883-19F73E4EBA?>
            <?define IdSafeLanguage = ja_JP?>
            <?elseif $(var.Language) = ko-KR?>
            <?define CompGUIDPrefix = 86C8F07C-80CA-420A-B6E7-86933D640C?>
            <?define IdSafeLanguage = ko_KR?>
            <?elseif $(var.Language) = nl-NL?>
            <?define CompGUIDPrefix = C68F115F-28DD-4B45-9512-405C432458?>
            <?define IdSafeLanguage = nl_NL?>
            <?elseif $(var.Language) = pl-PL?>
            <?define CompGUIDPrefix = 97494A31-5F57-4EC1-A6A9-994DF0813B?>
            <?define IdSafeLanguage = pl_PL?>
            <?elseif $(var.Language) = pt-BR?>
            <?define CompGUIDPrefix = F4985235-2AB9-446B-BF8E-B14929A160?>
            <?define IdSafeLanguage = pt_BR?>
            <?elseif $(var.Language) = pt-PT?>
            <?define CompGUIDPrefix = 58155841-D53A-4330-89D3-5C0338B928?>
            <?define IdSafeLanguage = pt_PT?>
            <!-- 
                <?elseif $(var.Language) = qps-ploc?>
                <?define CompGUIDPrefix = 75710CB2-DBDA-420B-9676-34D5F9D4A2?>
                <?define IdSafeLanguage = qps_ploc?>
                <?elseif $(var.Language) = qps-ploca?>
                <?define CompGUIDPrefix = 55AF2A35-F959-49AB-B9EF-DFC9964A4F?>
                <?define IdSafeLanguage = qps_ploca?>
                <?elseif $(var.Language) = qps-plocm?>
                <?define CompGUIDPrefix = D8CE2F7B-B0A1-4687-BFB7-1792B2FCCD?>
                <?define IdSafeLanguage = qps_plocm?> 
            -->
            <?elseif $(var.Language) = ru-RU?>
            <?define CompGUIDPrefix = 157BAF33-8D3F-46B7-9CF9-2C18E601CC?>
            <?define IdSafeLanguage = ru_RU?>
            <?elseif $(var.Language) = sv-SE?>
            <?define CompGUIDPrefix = 85B4199F-5F89-42C3-B7C2-DBCD3E5267?>
            <?define IdSafeLanguage = sv_SE?>
            <?elseif $(var.Language) = tr-TR?>
            <?define CompGUIDPrefix = EA375345-F52A-499B-A45E-108CE67EAF?>
            <?define IdSafeLanguage = tr_TR?>
            <?elseif $(var.Language) = zh-CN?>
            <?define CompGUIDPrefix = F8EE7CE9-58EA-4850-B76F-C22362DC0E?>
            <?define IdSafeLanguage = zh_CN?>
            <?elseif $(var.Language) = zh-TW?>
            <?define CompGUIDPrefix = F07F3210-79E2-4C38-AEF7-D8EBE06621?>
            <?define IdSafeLanguage = zh_TW?>
            <?else?>
            <?define IdSafeLanguage = $(var.Language)?>
            <?define CompGUIDPrefix = 94D9A417-56FC-435D-8167-A45F5D7A75?>
            <?endif?>
            <Component
                Id="Launcher_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)LauncherInstallFolder"
                Guid="$(var.CompGUIDPrefix)00">
                <File Id="Launcher_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\$(var.Language)\PowerToys.PowerLauncher.resources.dll" />
            </Component>
            <Component
                Id="FancyZonesEditor_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FancyZonesInstallFolder"
                Guid="$(var.CompGUIDPrefix)01">
                <File Id="FancyZonesEditor_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\$(var.FancyZonesProjectName)\$(var.Language)\PowerToys.FancyZonesEditor.resources.dll" />
            </Component>
            <Component
                Id="ImageResizer_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)ImageResizerInstallFolder"
                Guid="$(var.CompGUIDPrefix)02">
                <File Id="ImageResizer_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\$(var.ImageResizerProjectName)\$(var.Language)\PowerToys.ImageResizer.resources.dll" />
            </Component>
            <Component
                Id="ColorPicker_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)ColorPickerInstallFolder"
                Guid="$(var.CompGUIDPrefix)03">
                <File Id="ColorPicker_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\$(var.ColorPickerProjectName)\$(var.Language)\PowerToys.ColorPickerUI.resources.dll" />
            </Component>
            <Component
                Id="MarkdownPreviewHandler_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FileExplorerPreviewInstallFolder"
                Guid="$(var.CompGUIDPrefix)04">
                <File Id="MarkdownPreviewHandler_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\FileExplorerPreview\$(var.Language)\PowerToys.MarkdownPreviewHandler.resources.dll" />
            </Component>
            <Component
                Id="SVGPreviewHandler_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FileExplorerPreviewInstallFolder"
                Guid="$(var.CompGUIDPrefix)05">
                <File Id="SVGPreviewHandler_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\FileExplorerPreview\$(var.Language)\PowerToys.SvgPreviewHandler.resources.dll" />
            </Component>
            <Component
                Id="PDFPreviewHandler_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FileExplorerPreviewInstallFolder"
                Guid="$(var.CompGUIDPrefix)06">
                <File Id="PDFPreviewHandler_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\FileExplorerPreview\$(var.Language)\PowerToys.PdfPreviewHandler.resources.dll" />
            </Component>
            <Component
                Id="GcodePreviewHandler_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FileExplorerPreviewInstallFolder"
                Guid="$(var.CompGUIDPrefix)07">
                <File Id="GcodePreviewHandler_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\FileExplorerPreview\$(var.Language)\PowerToys.GcodePreviewHandler.resources.dll" />
            </Component>
            <!-- PowerToys Run aka Launcher plugin resources -->
            <Component
                Id="Launcher_Calculator_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)CalculatorPluginFolder"
                Guid="$(var.CompGUIDPrefix)08">
                <File Id="Launcher_Calculator_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Calculator\$(var.Language)\Microsoft.PowerToys.Run.Plugin.Calculator.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Folder_$(var.IdSafeLanguage)_Component"
                Directory="Resource$(var.IdSafeLanguage)FolderPluginFolder"
                Guid="$(var.CompGUIDPrefix)09">
                <File Id="Launcher_Folder_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Folder\$(var.Language)\Microsoft.Plugin.Folder.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Program_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)0A"
                Directory="Resource$(var.IdSafeLanguage)ProgramPluginFolder">
                <File Id="Launcher_Program_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Program\$(var.Language)\Microsoft.Plugin.Program.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Shell_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)0B"
                Directory="Resource$(var.IdSafeLanguage)ShellPluginFolder">
                <File Id="Launcher_Shell_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Shell\$(var.Language)\Microsoft.Plugin.Shell.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Indexer_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)0C"
                Directory="Resource$(var.IdSafeLanguage)IndexerPluginFolder">
                <File Id="Launcher_Indexer_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Indexer\$(var.Language)\Microsoft.Plugin.Indexer.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Uri_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)0D"
                Directory="Resource$(var.IdSafeLanguage)UriPluginFolder">
                <File Id="Launcher_Uri_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Uri\$(var.Language)\Microsoft.Plugin.Uri.resources.dll" />
            </Component>
            <Component
                Id="Launcher_VSCodeWorkspaces_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)0E"
                Directory="Resource$(var.IdSafeLanguage)VSCodeWorkspacesPluginFolder">
                <File Id="Launcher_VSCodeWorkspaces_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\$(var.Language)\Community.PowerToys.Run.Plugin.VSCodeWorkspaces.resources.dll" />
            </Component>
            <Component Id="Launcher_WindowWalker_$(var.IdSafeLanguage)_Component"
                       Guid="$(var.CompGUIDPrefix)0F"
                       Directory="Resource$(var.IdSafeLanguage)WindowWalkerPluginFolder">
                <File Id="Launcher_WindowWalker_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowWalker\$(var.Language)\Microsoft.Plugin.WindowWalker.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Registry_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)10"
                Directory="Resource$(var.IdSafeLanguage)RegistryPluginFolder">
                <File Id="Launcher_Registry_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Registry\$(var.Language)\Microsoft.PowerToys.Run.Plugin.Registry.resources.dll" />
            </Component>
            <Component
                Id="Launcher_Service_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)11"
                Directory="Resource$(var.IdSafeLanguage)ServicePluginFolder">
                <File Id="Launcher_Service_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\Service\$(var.Language)\Microsoft.PowerToys.Run.Plugin.Service.resources.dll" />
            </Component>
            <Component
                Id="Launcher_System_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)12"
                Directory="Resource$(var.IdSafeLanguage)SystemPluginFolder">
                <File Id="Launcher_System_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\System\$(var.Language)\Microsoft.PowerToys.Run.Plugin.System.resources.dll" />
            </Component>
            <Component
                Id="Launcher_WindowsSettings_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)13"
                Directory="Resource$(var.IdSafeLanguage)WindowsSettingsPluginFolder">
                <File Id="Launcher_WindowsSettings_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsSettings\$(var.Language)\Microsoft.PowerToys.Run.Plugin.WindowsSettings.resources.dll" />
            </Component>
            <Component
                Id="Launcher_TimeZone_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)14"
                Directory="Resource$(var.IdSafeLanguage)TimeZonePluginFolder">
                <File Id="Launcher_TimeZone_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeZone\$(var.Language)\Microsoft.PowerToys.Run.Plugin.TimeZone.resources.dll" />
            </Component>
            <Component
                Id="Launcher_WindowsTerminal_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)15"
                Directory="Resource$(var.IdSafeLanguage)WindowsTerminalPluginFolder">
                <File Id="Launcher_WindowsTerminal_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsTerminal\$(var.Language)\Microsoft.PowerToys.Run.Plugin.WindowsTerminal.resources.dll" />
            </Component>
            <Component
                Id="Launcher_WebSearch_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)16"
                Directory="Resource$(var.IdSafeLanguage)WebSearchPluginFolder">
                <File Id="Launcher_WebSearch_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\WebSearch\$(var.Language)\Community.PowerToys.Run.Plugin.WebSearch.resources.dll" />
            </Component>
            <Component
                Id="Launcher_UnitConverter_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)17"
                Directory="Resource$(var.IdSafeLanguage)UnitConverterPluginFolder">
                <File Id="Launcher_UnitConverter_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\UnitConverter\$(var.Language)\Community.PowerToys.Run.Plugin.UnitConverter.resources.dll" />
            </Component>
			<Component
                Id="Launcher_TimeDate_$(var.IdSafeLanguage)_Component"
                Guid="$(var.CompGUIDPrefix)18"
                Directory="Resource$(var.IdSafeLanguage)TimeDatePluginFolder">
                <File Id="Launcher_TimeDate_$(var.IdSafeLanguage)_File" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeDate\$(var.Language)\Microsoft.PowerToys.Run.Plugin.TimeDate.resources.dll" />
            </Component>
            <?undef IdSafeLanguage?>
            <?undef CompGUIDPrefix?>
            <?endforeach?>
            <?endif?>
        </ComponentGroup>
    </Fragment>
    <Fragment>
        <ComponentGroup Id="LauncherComponents">
            <Component Id="launcherShortcutComponent" Directory="LauncherInstallFolder" >
                <!-- Toast Notification AUMID -->
                <RegistryKey Root="HKLM" Key="SOFTWARE\Classes\AppUserModelId\PowerToysRun">
                    <RegistryValue Type="string" Name="DisplayName" Value="PowerToys Run" />
                    <RegistryValue Type="string" Name="IconUri" Value="[LauncherImagesFolder]RunAsset.ico" />
                </RegistryKey>
            </Component>

			<!-- !Warning! Make sure to change Component Guid if you update the file list -->
            <Component Id="launcherInstallComponent" Guid="5E7074E9-155F-49A1-BD4C-470A09814618" Directory="LauncherInstallFolder" >
                <File Source="$(var.BinX64Dir)modules\Launcher\PowerToys.Launcher.dll" />
                <?foreach File in concrt140_app.dll;e_sqlite3.dll;JetBrains.Annotations.dll;Mages.Core.dll;Mono.Cecil.dll;Mono.Cecil.Mdb.dll;Mono.Cecil.Pdb.dll;Mono.Cecil.Rocks.dll;msvcp140_1_app.dll;msvcp140_2_app.dll;msvcp140_app.dll;NLog.dll;NLog.Extensions.Logging.dll;PowerToys.PowerLauncher.deps.json;PowerToys.PowerLauncher.dll;PowerToys.PowerLauncher.exe;Microsoft.Xaml.Behaviors.dll;PowerToys.PowerLauncher.runtimeconfig.json;System.Data.OleDb.dll;UnitsNet.dll;vcamp140_app.dll;vccorlib140_app.dll;vcomp140_app.dll;vcruntime140_1_app.dll;vcruntime140_app.dll;Wox.Infrastructure.dll;Wox.Plugin.dll;PowerToys.Interop.dll;PowerToys.ManagedTelemetry.dll;PowerToys.PowerLauncher.Telemetry.dll;Microsoft.Data.Sqlite.dll;SQLitePCLRaw.batteries_v2.dll;SQLitePCLRaw.core.dll;SQLitePCLRaw.provider.e_sqlite3.dll;Microsoft.Extensions.Configuration.Abstractions.dll;Microsoft.Extensions.DependencyInjection.Abstractions.dll;Microsoft.Extensions.DependencyInjection.dll;Microsoft.Extensions.Logging.Abstractions.dll;Microsoft.Extensions.Logging.dll;Microsoft.Extensions.Options.dll;Microsoft.Extensions.Primitives.dll;ControlzEx.dll;PowerToys.ManagedCommon.dll;System.IO.Abstractions.dll;PowerToys.Common.UI.dll;System.ServiceProcess.ServiceController.dll;Microsoft.Toolkit.Uwp.Notifications.dll;ModernWpf.Controls.dll;ModernWpf.dll;WinRT.Runtime.dll;Microsoft.Windows.SDK.NET.dll;System.Text.Json.dll?>
                <File Id="File_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\$(var.File)" />
                <?endforeach?>
                <File Source="$(var.BinX64Dir)Settings\PowerToys.Settings.UI.Lib.dll" />
                <!-- VCRuntime -->
                <?foreach File in vcruntime140.dll;vcruntime140_1.dll;concrt140.dll;msvcp140.dll;msvcp140_1.dll;msvcp140_2.dll;msvcp140_codecvt_ids.dll;vccorlib140.dll?>
                <File Id="File_$(var.File)" Source="$(var.RepoDir)installer\VCRuntime\$(var.File)" />
                <?endforeach?>
            </Component>
			<?foreach File in $(var.launcherImagesComponentFiles)?>
			    <Component Id="launcherImagesComponent_$(var.File)" Win64="yes" Directory="LauncherImagesFolder">
				    <File Id="launcherImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
            <!-- Calculator Plugin -->
			<?foreach File in $(var.calcComponentFiles)?>
			    <Component Id="calcComponent_$(var.File)" Win64="yes" Directory="CalculatorPluginFolder">
				    <File Id="calcComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Calculator\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="calculatorImagesComponentLight" Directory="CalculatorImagesFolder" >
                <File Id="calculatorPluginImg_calculator_light" Source="$(var.BinX64Dir)modules\launcher\Plugins\Calculator\Images\calculator.light.png" />
            </Component>
			<Component Id="calculatorImagesComponentDark" Directory="CalculatorImagesFolder" >
    			<File Id="calculatorPluginImg_calculator_dark" Source="$(var.BinX64Dir)modules\launcher\Plugins\Calculator\Images\calculator.dark.png" />
			</Component>

            <!-- Folder Plugin -->
			<?foreach File in $(var.FolderComponentFiles)?>
			    <Component Id="FolderComponent_$(var.File)" Win64="yes" Directory="FolderPluginFolder">
				    <File Id="FolderComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Folder\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.FolderImagesComponentFiles)?>
			    <Component Id="FolderImagesComponent_$(var.File)" Win64="yes" Directory="FolderPluginImagesFolder">
				    <File Id="FolderImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Folder\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
			
            <!-- Program Plugin -->
            <?foreach File in $(var.ProgramComponentFiles)?>
                <Component Id="ProgramComponent_$(var.File)" Win64="yes" Directory="ProgramPluginFolder">
                    <File Id="ProgramComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Program\$(var.File)" />
                </Component>
            <?endforeach?>

			<?foreach File in $(var.ProgramImagesComponentFiles)?>
			<Component Id="ProgramImagesComponent_$(var.File)" Win64="yes" Directory="ProgramImagesFolder">
				<File Id="ProgramImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Program\Images\$(var.File)" />
			</Component>
			<?endforeach?>
			
            <!-- Shell Plugin -->
			<?foreach File in $(var.ShellComponentFiles)?>
			    <Component Id="ShellComponent_$(var.File)" Win64="yes" Directory="ShellPluginFolder">
				    <File Id="ShellComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Shell\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.ShellImagesComponentFiles)?>
			    <Component Id="ShellImagesComponent_$(var.File)" Win64="yes" Directory="ShellImagesFolder">
				    <File Id="ShellImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Shell\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
			
			<!-- Indexer Plugin -->
			<?foreach File in $(var.IndexerComponentFiles)?>
			    <Component Id="IndexerComponent_$(var.File)" Win64="yes" Directory="IndexerPluginFolder">
				    <File Id="IndexerComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Indexer\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.IndexerImagesComponentFiles)?>
			    <Component Id="IndexerImagesComponent_$(var.File)" Win64="yes" Directory="IndexerImagesFolder">
				    <File Id="IndexerImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Indexer\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
			
			<!-- UnitConverter Plugin -->
			<?foreach File in $(var.UnitConvCompFiles)?>
			    <Component Id="UnitConvComp_$(var.File)" Win64="yes" Directory="UnitConverterPluginFolder">
				    <File Id="UnitConvCompFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\UnitConverter\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="UnitConverterImagesComponentLight" Directory="UnitConverterImagesFolder" >
                <File Id="UnitConverterLight" Source="$(var.BinX64Dir)modules\launcher\Plugins\UnitConverter\Images\unitconverter.light.png" />
            </Component>
			<Component Id="UnitConverterImagesComponentDark" Directory="UnitConverterImagesFolder" >
			    <File Id="UnitConverterDark" Source="$(var.BinX64Dir)modules\launcher\Plugins\UnitConverter\Images\unitconverter.dark.png" />
			</Component>

            <!-- WebSearch Plugin -->
			<?foreach File in $(var.WebSrchCompFiles)?>
			    <Component Id="WebSrchComp_$(var.File)" Win64="yes" Directory="WebSearchPluginFolder">
				    <File Id="WebSrchCompFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\WebSearch\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="WebSearchImagesComponentLight" Directory="WebSearchImagesFolder" >
                <File Id="WebSearchLight" Source="$(var.BinX64Dir)modules\launcher\Plugins\WebSearch\Images\WebSearch.light.png" />
            </Component>
			<Component Id="WebSearchImagesComponentDark" Directory="WebSearchImagesFolder" >
			    <File Id="WebSearchDark" Source="$(var.BinX64Dir)modules\launcher\Plugins\WebSearch\Images\WebSearch.dark.png" />
			</Component>

            <!-- Uri Plugin -->
			<?foreach File in $(var.UriComponentFiles)?>
			    <Component Id="UriComponent_$(var.File)" Win64="yes" Directory="UriPluginFolder">
				    <File Id="UriComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Uri\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="UriImagesComponentLight" Directory="UriImagesFolder" >
                <File Id="UriLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Uri\Images\Uri.light.png" />
            </Component>
			<Component Id="UriImagesComponentDark" Directory="UriImagesFolder" >
			    <File Id="UriDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Uri\Images\Uri.dark.png" />
			</Component>

            <!-- VSCodeWorkspaces Plugin -->
			<?foreach File in $(var.VSCWrkCompFiles)?>
			    <Component Id="VSCWrkComp_$(var.File)" Win64="yes" Directory="VSCodeWorkspacesPluginFolder">
				    <File Id="VSCWrkCompFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="VSCodeWorkspacesDepsComponent" Directory="VSCodeWorkspacesPluginFolder">
				<File Id="VSCodeWorkspaceFolder_deps" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\Community.PowerToys.Run.Plugin.VSCodeWorkspaces.deps.json" />
			</Component>
			<Component Id="VSCodeWorkspacesImagesComponentLight" Directory="VSCodeWorkspaceImagesFolder" >
                <File Id="VSCodeWorkspaceCodeLight" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\Images\code-light.png" />
            </Component>
			<Component Id="VSCodeWorkspacesImagesComponentDark" Directory="VSCodeWorkspaceImagesFolder" >
    			<File Id="VSCodeWorkspaceCodeDark" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\Images\code-dark.png" />
			</Component>
			<Component Id="VSCodeWorkspacesImagesComponentFolder" Directory="VSCodeWorkspaceImagesFolder" >
			    <File Id="VSCodeWorkspaceFolder" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\Images\folder.png" />
			</Component>
			<Component Id="VSCodeWorkspacesImagesComponentMonitor" Directory="VSCodeWorkspaceImagesFolder" >
			    <File Id="VSCodeWorkspaceRemote" Source="$(var.BinX64Dir)modules\launcher\Plugins\VSCodeWorkspaces\Images\monitor.png" />
			</Component>

            <!-- WindowWalker Plugin -->
			<?foreach File in $(var.WindowWlkrCompFiles)?>
			    <Component Id="WindowWlkrComp_$(var.File)" Win64="yes" Directory="WindowWalkerPluginFolder">
				    <File Id="WindowWlkrCompFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowWalker\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.WindowWlkrImagesCompFiles)?>
			    <Component Id="WindowWalkerImagesComp_$(var.File)" Win64="yes" Directory="WindowWalkerImagesFolder">
				    <File Id="WindowWalkerImagesComp_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowWalker\Images\$(var.File)" />
			    </Component>
			<?endforeach?>

            <!-- Registry Plugin -->
			<?foreach File in $(var.RegistryComponentFiles)?>
			    <Component Id="RegistryComponent_$(var.File)" Win64="yes" Directory="RegistryPluginFolder">
				    <File Id="RegistryComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Registry\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="RegistryImagesComponentLight" Directory="RegistryImagesFolder" >
                <File Id="RegistryLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Registry\Images\reg.light.png" />
            </Component>
			<Component Id="RegistryImagesComponentDark" Directory="RegistryImagesFolder" >
			    <File Id="RegistryDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Registry\Images\reg.dark.png" />
			</Component>

            <!-- Service Plugin -->
			<?foreach File in $(var.ServiceComponentFiles)?>
			    <Component Id="ServiceComponent_$(var.File)" Win64="yes" Directory="ServicePluginFolder">
				    <File Id="ServiceComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\Service\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="ServiceImagesComponentLight" Directory="ServiceImagesFolder" >
                <File Id="ServiceLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Service\Images\service.light.png" />
            </Component>
			<Component Id="ServiceImagesComponentDark" Directory="ServiceImagesFolder" >
			    <File Id="ServiceDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\Service\Images\service.dark.png" />
			</Component>

            <!-- System Plugin -->
			<?foreach File in $(var.SystemComponentFiles)?>
			    <Component Id="SystemComponent_$(var.File)" Win64="yes" Directory="SystemPluginFolder">
				    <File Id="SystemComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\System\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.SystemImagesComponentFiles)?>
			    <Component Id="SystemImagesComponent_$(var.File)" Win64="yes" Directory="SystemImagesFolder">
				    <File Id="SystemImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\System\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
			
			<!-- TimeDate Plugin -->
			<?foreach File in $(var.TimeDateComponentFiles)?>
			    <Component Id="TimeDateComponent_$(var.File)" Win64="yes" Directory="TimeDatePluginFolder">
				    <File Id="TimeDateComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeDate\$(var.File)" />
			    </Component>
			<?endforeach?>
			<?foreach File in $(var.TimeDateImagesComponentFiles)?>
			    <Component Id="TimeDateImagesComponent_$(var.File)" Win64="yes" Directory="TimeDateImagesFolder">
				    <File Id="TimeDateImagesComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeDate\Images\$(var.File)" />
			    </Component>
			<?endforeach?>
      
            <!-- TimeZone Plugin -->
            <?foreach File in $(var.TimeZoneComponentFiles)?>
			    <Component Id="TimeZoneComponent_$(var.File)" Win64="yes" Directory="TimeZonePluginFolder">
				    <File Id="TimeZoneComponentFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeZone\$(var.File)" />
			    </Component>
			<?endforeach?>
            <Component Id="TimeZoneImagesComponentLight" Directory="TimeZoneImagesFolder" >
                <File Id="TimeZoneLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeZone\Images\timeZone.light.png" />
            </Component>
            <Component Id="TimeZoneImagesComponentDark" Directory="TimeZoneImagesFolder" >
	            <File Id="TimeZoneDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\TimeZone\Images\timeZone.dark.png" />
		    </Component>
      
            <!-- WindowsSettings Plugin -->
			<?foreach File in $(var.WinSetCmpFiles)?>
			    <Component Id="WinSetCmp_$(var.File)" Win64="yes" Directory="WindowsSettingsPluginFolder">
				    <File Id="WinSetCmpFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsSettings\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="WindowsSettingsImagesComponentLight" Directory="WindowsSettingsImagesFolder" >
                <File Id="WindowsSettingsLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsSettings\Images\WindowsSettings.light.png" />
            </Component>
			<Component Id="WindowsSettingsImagesComponentDark" Directory="WindowsSettingsImagesFolder" >
			    <File Id="WindowsSettingsDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsSettings\Images\WindowsSettings.dark.png" />
			</Component>

            <!-- WindowsTerminal Plugin -->
			<?foreach File in $(var.WinTermCmpFiles)?>
			    <Component Id="WinTermCmp_$(var.File)" Win64="yes" Directory="WindowsTerminalPluginFolder">
				    <File Id="WinTermCmpFile_$(var.File)" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsTerminal\$(var.File)" />
			    </Component>
			<?endforeach?>
			<Component Id="WindowsTerminalImagesComponentLight" Directory="WindowsTerminalImagesFolder" >
                <File Id="WindowsTerminalLightIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsTerminal\Images\WindowsTerminal.light.png" />
            </Component>
			<Component Id="WindowsTerminalImagesComponentDark" Directory="WindowsTerminalImagesFolder" >
			    <File Id="WindowsTerminalDarkIcon" Source="$(var.BinX64Dir)modules\launcher\Plugins\WindowsTerminal\Images\WindowsTerminal.dark.png" />
			</Component>

        </ComponentGroup>
    </Fragment>
</Wix>
